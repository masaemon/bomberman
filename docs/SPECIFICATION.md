# Bomberman Game - 仕様書

## 1. ゲーム概要
ブラウザで動作する2Dボンバーマンゲーム。プレイヤーは爆弾を設置してAI敵を倒し、最後まで生き残ることを目指す。

## 2. 技術仕様

### 2.1 技術スタック
- **言語**: TypeScript
- **ビルドツール**: Vite
- **ゲームエンジン**: Phaser 3.70.0
- **ターゲット**:
  - デスクトップ: モダンブラウザ（Chrome、Firefox、Safari、Edge）
  - モバイル: iOS Safari、Android Chrome

### 2.2 画面仕様
- **解像度**: レスポンシブ（デバイスに応じて自動調整）
- **タイルサイズ**: デバイスに応じて調整
  - デスクトップ: 32px × 32px
  - モバイル: 画面サイズに合わせて自動計算
- **レンダリング**: Canvas（Phaser WebGL/Canvas）
- **画面向き**: 横向き推奨（縦向きでも対応）

## 3. ゲームプレイ仕様

### 3.1 フィールド
- **デフォルトサイズ**: 横30マス × 縦15マス（全デバイス共通）
- **サイズ変更**: 設定により変更可能
- **タイル種類**:
  - 空白（移動可能）
  - 破壊不可能な壁（固定）
  - 破壊可能な壁（爆風で破壊可能）

### 3.2 マップ生成ルール
1. 外周は破壊不可能な壁で囲む
2. 内部に破壊不可能な壁を格子状に配置（1マスおき）
3. 残りの約40%に破壊可能な壁をランダム配置
4. プレイヤー・敵の初期位置周囲2マスは壁を配置しない（安全地帯）

### 3.3 プレイヤー
#### 初期ステータス
- **移動速度**: 150px/秒
- **爆弾設置数**: 1個（同時設置可能数）
- **爆風範囲**: 2マス（上下左右）
- **HP**: 1（1ヒットで死亡）

#### 操作
**デスクトップ:**
- **移動**: 矢印キー または WASD
- **爆弾設置**: スペースキー

**モバイル:**
- **移動**: バーチャルジョイスティック（画面左半分をタッチ＆スライド）
- **爆弾設置**: 爆弾ボタン（画面右下）※未実装

#### パワーアップ
破壊可能な壁を壊すとランダムでパワーアップアイテムが出現：
1. **爆弾数増加** (+1個、最大8個)
2. **爆風範囲拡大** (+1マス、最大8マス)
3. **移動速度アップ** (+30px/秒、最大300px/秒)

### 3.4 爆弾・爆発
#### 爆弾
- **設置**: プレイヤーの現在位置に設置
- **起爆時間**: 3秒
- **同時設置数**: 初期1個（パワーアップで増加）
- **挙動**: 設置後その場に固定、爆発後消滅

#### 爆発
- **範囲**: 十字方向（上下左右）にN マス
- **持続時間**: 0.5秒
- **効果**:
  - プレイヤー・敵に接触すると死亡
  - 破壊可能な壁を破壊
  - 破壊不可能な壁で遮断される
  - 他の爆弾に接触すると誘爆（即座に爆発）

### 3.5 敵AI
#### 基本仕様
- **数**: 3体
- **初期ステータス**: プレイヤーと同じ
- **初期位置**: マップの四隅（ランダム3箇所）

#### AI行動（初期実装）
1. **移動**: ランダム方向に移動
2. **爆弾設置**: 一定確率で設置（10%/秒）
3. **自爆回避**: なし（シンプル版）

#### AI行動（将来の改良案）
- 自爆回避ロジック
- プレイヤー追跡
- 壁破壊の優先度付け

### 3.6 フィールド縮小機能
#### タイミング
- **開始**: ゲーム開始から60秒後
- **警告**: 縮小開始5秒前に警告表示

#### 縮小ルール
- **ペース**: 15秒ごとに1マスずつ縮小
- **方向**: 外周から中心に向かって
- **縮小順序**: 上→下→左→右の順で交互に縮小
- **効果**:
  - 縮小エリアに侵入すると即死
  - 縮小エリアにいる敵も死亡
  - 縮小後は壁として扱う（通行不可）

#### 縮小の可視化
- 次に縮小されるエリアを赤色で表示
- カウントダウンタイマー表示

### 3.7 勝利・敗北条件
#### 勝利
- すべての敵AIを倒す

#### 敗北
- プレイヤーが死亡
  - 爆風に当たる
  - フィールド縮小エリアに侵入

## 4. UI仕様

### 4.1 ゲーム画面
**HUD（上部）**:
- 残り敵数
- 経過時間
- フィールド縮小までのカウントダウン
- プレイヤーステータス（爆弾数、爆風範囲、速度）

**モバイル専用UI**:
- **バーチャルジョイスティック**（画面左半分）
  - タッチした位置にジョイスティックが出現
  - スライドで移動方向を指定（アナログ入力対応）
  - 指を離すとジョイスティックが消える
  - 半透明表示
- **爆弾ボタン**（画面右下）※未実装
  - 大きめのボタン
  - タッチ操作対応
  - 半透明表示

### 4.2 リザルト画面
- 勝利/敗北メッセージ
- プレイ時間
- 倒した敵数
- リトライボタン

### 4.3 レスポンシブ対応
- ゲーム画面は画面サイズに合わせて自動スケーリング
- モバイルでは仮想コントローラーを表示
- デスクトップでは仮想コントローラーを非表示

## 5. パフォーマンス要件
- **FPS**: 60fps維持（デスクトップ）、30fps以上（モバイル）
- **起動時間**: 3秒以内
- **メモリ使用量**:
  - デスクトップ: 100MB以下
  - モバイル: 50MB以下

## 6. モバイル対応詳細

### 6.1 デバイス検出
- User Agentまたはタッチイベント対応でモバイル判定
- 画面サイズでレイアウトを自動調整

### 6.2 タッチ操作
- マルチタッチ対応（移動しながら爆弾設置可能）
- タッチフィードバック（ボタン押下時の視覚効果）
- 誤タッチ防止（適切なボタンサイズ）

### 6.3 最適化
- モバイルではエフェクトを軽量化
- バッテリー消費を考慮したレンダリング
- 通信量削減（将来のオンライン対応時）

## 7. 今後の拡張可能性
- マルチプレイヤー対応
- ステージ選択
- カスタムマップエディタ
- リプレイ機能
- ランキングシステム
- PWA対応（オフラインプレイ）
